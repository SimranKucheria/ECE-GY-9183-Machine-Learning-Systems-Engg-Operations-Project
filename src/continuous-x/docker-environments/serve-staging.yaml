name: deeptrust_serve-staging
services:
  fastapi_server:
    extends:
      file: ../serving/docker-compose-serve.yaml
      service: fastapi_server
    ports:
      - "8100:8000"  # for HTTP requests

  triton_server:
    extends:
      file: ../serving/docker-compose-serve.yaml
      service: triton_server
    ports:
      - "8110:8010"  # for HTTP requests
      - "8101:8001"  # for GRPC requests
      - "8102:8002"  # for reporting metrics

  vllm:
    extends:
      file: ../serving/docker-compose-serve.yaml
      service: vllm
    ports:
      - "8105:8000"  # for HTTP requests  

  jupyter:
    extends:
      file: ../serving/docker-compose-serve.yaml
      service: vllm
    ports:
      - "8188:8888"  # for HTTP requests 

  fetcher:
    extends:
      file: ../serving/docker-compose-serve.yaml
      service: fetcher
    ports:
      - "5100:5000"
    volumes:
      - ./inference_service/:/data/vit
      - ./BLIP/:/data/blip
    environment:
      - DOCKER_COMPOSE_DIR=/tmp/deeptrust/src/continuous-x/docker-environments/serve-staging.yaml
      - MLFLOW_TRACKING_URI=http://${FLOATING_IP}:8000 
    restart: always   

